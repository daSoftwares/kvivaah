(function(e){var t={init:function(n){var r=this;if(!r.data("jqv")||r.data("jqv")==null){t._saveOptions(r,n);e(".formError").on("click",function(){e(this).fadeOut(150,function(){e(this).remove()})})}},attach:function(n){var r=this;var i;if(n)i=t._saveOptions(r,n);else i=r.data("jqv");var s=r.find("[data-validation-engine*=validate]")?"data-validation-engine":"class";if(!i.binded){if(i.bindMethod=="bind"){r.find("[class*=validate]").not("[type=checkbox]").not("[type=radio]").not(".datepicker").bind(i.validationEventTrigger,t._onFieldEvent);r.find("[class*=validate][type=checkbox],[class*=validate][type=radio]").bind("click",t._onFieldEvent);r.find("[class*=validate][class*=datepicker]").bind(i.validationEventTrigger,{delay:300},t._onFieldEvent);r.bind("submit",t._onSubmitEvent)}else if(i.bindMethod=="live"){r.find("[class*=validate]").not("[type=checkbox]").not(".datepicker").live(i.validationEventTrigger,t._onFieldEvent);r.find("[class*=validate][type=checkbox]").live("click",t._onFieldEvent);r.find("[class*=validate][class*=datepicker]").live(i.validationEventTrigger,{delay:300},t._onFieldEvent);r.live("submit",t._onSubmitEvent)}i.binded=true;if(i.autoPositionUpdate){e(window).bind("resize",{noAnimation:true,formElem:r},t.updatePromptsPosition)}}return this},detach:function(){var n=this;var r=n.data("jqv");if(r.binded){n.find("[class*=validate]").not("[type=checkbox]").unbind(r.validationEventTrigger,t._onFieldEvent);n.find("[class*=validate][type=checkbox],[class*=validate][type=radio]").unbind("click",t._onFieldEvent);n.unbind("submit",t.onAjaxFormComplete);n.find("[class*=validate]").not("[type=checkbox]").die(r.validationEventTrigger,t._onFieldEvent);n.find("[class*=validate][type=checkbox]").die("click",t._onFieldEvent);n.die("submit",t.onAjaxFormComplete);n.removeData("jqv");if(r.autoPositionUpdate){e(window).unbind("resize",t.updatePromptsPosition)}}},validate:function(){return t._validateFields(this)},validateField:function(n){var r=e(this).data("jqv");var i=t._validateField(e(n),r);if(r.onSuccess&&r.InvalidFields.length==0)r.onSuccess();else if(r.onFailure&&r.InvalidFields.length>0)r.onFailure();return i},validateform:function(){return t._onSubmitEvent.call(this)},updatePromptsPosition:function(n){if(n&&this==window)var r=n.data.formElem,i=n.data.noAnimation;else var r=this.closest("form");var s=r.data("jqv");r.find("[class*=validate]").not(":hidden").not(":disabled").each(function(){var n=e(this);var r=t._getPrompt(n);var o=e(r).find(".formErrorContent").html();if(r)t._updatePrompt(n,e(r),o,undefined,false,s,i)})},showPrompt:function(e,n,r,i){var s=this.closest("form");var o=s.data("jqv");if(!o)o=t._saveOptions(this,o);if(r)o.promptPosition=r;o.showArrow=i==true;t._showPrompt(this,e,n,false,o)},hidePrompt:function(){var n="."+t._getClassName(e(this).attr("id"))+"formError";e(n).fadeTo("fast",.3,function(){e(this).remove()})},hide:function(){var t;if(e(this).is("form")){t="parentForm"+e(this).attr("id")}else{t=e(this).attr("id")+"formError"}e("."+t).fadeTo("fast",.3,function(){e(this).remove()})},hideAll:function(){e(".formError").fadeTo("fast",.3,function(){e(this).remove()})},_onFieldEvent:function(n){var r=e(this);var i=r.closest("form");var s=i.data("jqv");window.setTimeout(function(){t._validateField(r,s);if(s.InvalidFields.length==0&&s.onSuccess){s.onSuccess()}else if(s.InvalidFields.length>0&&s.onFailure){s.onFailure()}},n.data?n.data.delay:0)},_onSubmitEvent:function(){var n=e(this);var r=n.data("jqv");var i=t._validateFields(n,true);if(i&&r.ajaxFormValidation){t._validateFormWithAjax(n,r);return false}if(r.onValidationComplete){r.onValidationComplete(n,i);return false}return i},_checkAjaxStatus:function(t){var n=true;e.each(t.ajaxValidCache,function(e,t){if(!t){n=false;return false}});return n},_validateFields:function(n,r){var i=n.data("jqv");var s=false;n.trigger("jqv.form.validating");var o=null;n.find("[class*=validate]").not(":hidden").not(":disabled").each(function(){var n=e(this);s|=t._validateField(n,i,r);if(s&&o==null)o=n});n.trigger("jqv.form.result",[s]);if(s){if(i.scroll){var u=o.offset().top;var a=o.offset().left;if(i.promptPosition!="bottomRight"&&i.promptPosition!="bottomLeft"){var f=t._getPrompt(o);u=f.offset().top}e("html:not(:animated),body:not(:animated)").animate({scrollTop:u,scrollLeft:a},1100,function(){if(i.focusFirstField)o.focus()});if(i.isOverflown){var l=e(i.overflownDIV);var c=l.scrollTop();var h=-parseInt(l.offset().top);u+=c+h-5;var p=e(i.overflownDIV+":not(:animated)");p.animate({scrollTop:u},1100)}}else{if(i.focusFirstField)o.focus()}return false}return true},_validateFormWithAjax:function(n,r){var i=n.serialize();var s=r.ajaxFormValidationURL?r.ajaxFormValidationURL:n.attr("action");e.ajax({type:"GET",url:s,cache:false,dataType:"json",data:i,form:n,methods:t,options:r,beforeSend:function(){return r.onBeforeAjaxFormValidation(n,r)},error:function(e,n){t._ajaxError(e,n)},success:function(i){if(i!==true){var s=false;for(var o=0;o<i.length;o++){var u=i[o];var a=u[0];var f=e(e("#"+a)[0]);if(f.length==1){var l=u[2];if(u[1]==true){if(l==""||!l){t._closePrompt(f)}else{if(r.allrules[l]){var c=r.allrules[l].alertTextOk;if(c)l=c}t._showPrompt(f,l,"pass",false,r,true)}}else{s|=true;if(r.allrules[l]){var c=r.allrules[l].alertText;if(c)l=c}t._showPrompt(f,l,"",false,r,true)}}}r.onAjaxFormComplete(!s,n,i,r)}else r.onAjaxFormComplete(true,n,"",r)}})},_validateField:function(n,r,i){if(!n.attr("id"))e.error("jQueryValidate: an ID attribute is required for this field: "+n.attr("name")+" class:"+n.attr("class"));var s=n.attr("class");var o=/validate\[(.*)\]/.exec(s);if(!o)return false;var u=o[1];var a=u.split(/\[|,|\]/);var f=false;var l=n.attr("name");var c="";var h=false;r.isError=false;r.showArrow=true;for(var p=0;p<a.length;p++){a[p]=a[p].replace(" ","");var d=undefined;switch(a[p]){case"required":h=true;d=t._required(n,a,p,r);break;case"custom":d=t._customRegex(n,a,p,r);break;case"groupRequired":var v="[class*="+a[p+1]+"]";var m=n.closest("form").find(v).eq(0);if(m[0]!=n[0]){t._validateField(m,r,i);r.showArrow=true;continue}d=t._groupRequired(n,a,p,r);if(d)h=true;r.showArrow=false;break;case"ajax":if(!i){t._ajax(n,a,p,r);f=true}break;case"minSize":d=t._minSize(n,a,p,r);break;case"maxSize":d=t._maxSize(n,a,p,r);break;case"min":d=t._min(n,a,p,r);break;case"max":d=t._max(n,a,p,r);break;case"past":d=t._past(n,a,p,r);break;case"future":d=t._future(n,a,p,r);break;case"dateRange":var v="[class*="+a[p+1]+"]";var m=n.closest("form").find(v).eq(0);var g=n.closest("form").find(v).eq(1);if(m[0].value||g[0].value){d=t._dateRange(m,g,a,p,r)}if(d)h=true;r.showArrow=false;break;case"dateTimeRange":var v="[class*="+a[p+1]+"]";var m=n.closest("form").find(v).eq(0);var g=n.closest("form").find(v).eq(1);if(m[0].value||g[0].value){d=t._dateTimeRange(m,g,a,p,r)}if(d)h=true;r.showArrow=false;break;case"maxCheckbox":d=t._maxCheckbox(n,a,p,r);n=e(e("input[name='"+l+"']"));break;case"minCheckbox":d=t._minCheckbox(n,a,p,r);n=e(e("input[name='"+l+"']"));break;case"equals":d=t._equals(n,a,p,r);break;case"funcCall":d=t._funcCall(n,a,p,r);break;default:}if(d!==undefined){c+=d+"<br/>";r.isError=true}}if(!h){if(n.val()=="")r.isError=false}var y=n.attr("type");var b=n.closest("form");if((y=="radio"||y=="checkbox")&&e(b).find("input[name='"+l+"']").size()>1){n=e(e(b).find("input[name='"+l+"'][type!=hidden]:first"));r.showArrow=false}if(y=="text"&&e(b).find("input[name='"+l+"']").size()>1){n=e(e(b).find("input[name='"+l+"'][type!=hidden]:first"));r.showArrow=false}if(r.isError){t._showPrompt(n,c,"",false,r)}else{if(!f)t._closePrompt(n)}n.trigger("jqv.field.result",[n,r.isError,c]);var w=e.inArray(n[0],r.InvalidFields);if(w==-1){if(r.isError)r.InvalidFields.push(n[0])}else if(!r.isError){r.InvalidFields.splice(w,1)}return r.isError},_required:function(t,n,r,i){switch(t.attr("type")){case"text":case"password":case"textarea":case"file":default:if(!t.val())return i.allrules[n[r]].alertText;break;case"radio":case"checkbox":var s=t.attr("name");if(e("input[name='"+s+"']:checked").size()==0){if(e("input[name='"+s+"']").size()==1)return i.allrules[n[r]].alertTextCheckboxe;else return i.allrules[n[r]].alertTextCheckboxMultiple}break;case"select-one":if(!t.val())return i.allrules[n[r]].alertText;break;case"select-multiple":if(!t.find("option:selected").val())return i.allrules[n[r]].alertText;break}},_groupRequired:function(n,r,i,s){var o="[class*="+r[i+1]+"]";var u=false;n.closest("form").find(o).each(function(){if(!t._required(e(this),r,i,s)){u=true;return false}});if(!u)return s.allrules[r[i]].alertText},_customRegex:function(e,t,n,r){var i=t[n+1];var s=r.allrules[i];if(!s){alert("jqv:custom rule not found "+i);return}var o=s.regex;if(!o){alert("jqv:custom regex not found "+i);return}var u=new RegExp(o);if(!u.test(e.val()))return r.allrules[i].alertText},_funcCall:function(e,t,n,r){var i=t[n+1];var s=window[i];if(typeof s=="function")return s(e,t,n,r)},_equals:function(t,n,r,i){var s=n[r+1];if(t.val()!=e("#"+s).val())return i.allrules.equals.alertText},_maxSize:function(e,t,n,r){var i=t[n+1];var s=e.val().length;if(s>i){var o=r.allrules.maxSize;return o.alertText+i+o.alertText2}},_minSize:function(e,t,n,r){var i=t[n+1];var s=e.val().length;if(s<i){var o=r.allrules.minSize;return o.alertText+i+o.alertText2}},_min:function(e,t,n,r){var i=parseFloat(t[n+1]);var s=parseFloat(e.val());if(s<i){var o=r.allrules.min;if(o.alertText2)return o.alertText+i+o.alertText2;return o.alertText+i}},_max:function(e,t,n,r){var i=parseFloat(t[n+1]);var s=parseFloat(e.val());if(s>i){var o=r.allrules.max;if(o.alertText2)return o.alertText+i+o.alertText2;return o.alertText+i}},_past:function(e,n,r,i){var s=n[r+1];var o=s.toLowerCase()=="now"?new Date:t._parseDate(s);var u=t._parseDate(e.val());if(u<o){var a=i.allrules.past;if(a.alertText2)return a.alertText+t._dateToString(o)+a.alertText2;return a.alertText+t._dateToString(o)}},_future:function(e,n,r,i){var s=n[r+1];var o=s.toLowerCase()=="now"?new Date:t._parseDate(s);var u=t._parseDate(e.val());if(u>o){var a=i.allrules.future;if(a.alertText2)return a.alertText+t._dateToString(o)+a.alertText2;return a.alertText+t._dateToString(o)}},_isDate:function(e){var t=new RegExp(/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(?:(?:0?[1-9]|1[0-2])(\/|-)(?:0?[1-9]|1\d|2[0-8]))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(0?2(\/|-)29)(\/|-)(?:(?:0[48]00|[13579][26]00|[2468][048]00)|(?:\d\d)?(?:0[48]|[2468][048]|[13579][26]))$/);if(t.test(e)){return true}return false},_isDateTime:function(e){var t=new RegExp(/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1}$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^((1[012]|0?[1-9]){1}\/(0?[1-9]|[12][0-9]|3[01]){1}\/\d{2,4}\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1})$/);if(t.test(e)){return true}return false},_dateCompare:function(e,t){return new Date(e.toString())<new Date(t.toString())},_dateRange:function(e,n,r,i,s){if(!e[0].value&&n[0].value||e[0].value&&!n[0].value){return s.allrules[r[i]].alertText+s.allrules[r[i]].alertText2}if(!t._isDate(e[0].value)||!t._isDate(n[0].value)){return s.allrules[r[i]].alertText+s.allrules[r[i]].alertText2}if(!t._dateCompare(e[0].value,n[0].value)){return s.allrules[r[i]].alertText+s.allrules[r[i]].alertText2}},_dateTimeRange:function(e,n,r,i,s){if(!e[0].value&&n[0].value||e[0].value&&!n[0].value){return s.allrules[r[i]].alertText+s.allrules[r[i]].alertText2}if(!t._isDateTime(e[0].value)||!t._isDateTime(n[0].value)){return s.allrules[r[i]].alertText+s.allrules[r[i]].alertText2}if(!t._dateCompare(e[0].value,n[0].value)){return s.allrules[r[i]].alertText+s.allrules[r[i]].alertText2}},_maxCheckbox:function(t,n,r,i){var s=n[r+1];var o=t.attr("name");var u=e("input[name='"+o+"']:checked").size();if(u>s){i.showArrow=false;if(i.allrules.maxCheckbox.alertText2)return i.allrules.maxCheckbox.alertText+" "+s+" "+i.allrules.maxCheckbox.alertText2;return i.allrules.maxCheckbox.alertText}},_minCheckbox:function(t,n,r,i){var s=n[r+1];var o=t.attr("name");var u=e("input[name='"+o+"']:checked").size();if(u<s){i.showArrow=false;return i.allrules.minCheckbox.alertText+" "+s+" "+i.allrules.minCheckbox.alertText2}},_ajax:function(n,r,i,s){var o=r[i+1];var u=s.allrules[o];var a=u.extraData;var f=u.extraDataDynamic;if(!a)a="";if(f){var l=[];var c=String(f).split(",");for(var i=0;i<c.length;i++){var h=c[i];if(e(h).length){var p=n.closest("form").find(h).val();var d=h.replace("#","")+"="+escape(p);l.push(d)}}f=l.join("&")}else{f=""}if(!s.isError){e.ajax({type:"GET",url:u.url,cache:false,dataType:"json",data:"fieldId="+n.attr("id")+"&fieldValue="+n.val()+"&extraData="+a+"&"+f,field:n,rule:u,methods:t,options:s,beforeSend:function(){var e=u.alertTextLoad;if(e)t._showPrompt(n,e,"load",true,s)},error:function(e,n){t._ajaxError(e,n)},success:function(n){var r=n[0];var i=e(e("#"+r)[0]);if(i.length==1){var o=n[1];var a=n[2];if(!o){s.ajaxValidCache[r]=false;s.isError=true;if(a){if(s.allrules[a]){var f=s.allrules[a].alertText;if(f)a=f}}else a=u.alertText;t._showPrompt(i,a,"",true,s)}else{if(s.ajaxValidCache[r]!==undefined)s.ajaxValidCache[r]=true;if(a){if(s.allrules[a]){var f=s.allrules[a].alertTextOk;if(f)a=f}}else a=u.alertTextOk;if(a)t._showPrompt(i,a,"pass",true,s);else t._closePrompt(i)}}}})}},_ajaxError:function(e,t){if(e.status==0&&t==null)alert("The page is not served from a server! ajax call failed");else if(typeof console!="undefined")console.log("Ajax error: "+e.status+" "+t)},_dateToString:function(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},_parseDate:function(e){var t=e.split("-");if(t==e)t=e.split("/");return new Date(t[0],t[1]-1,t[2])},_showPrompt:function(e,n,r,i,s,o){var u=t._getPrompt(e);if(o)u=false;if(u)t._updatePrompt(e,u,n,r,i,s);else t._buildPrompt(e,n,r,i,s)},_buildPrompt:function(n,r,i,s,o){var u=e("<div>");u.addClass(t._getClassName(n.attr("id"))+"formError");if(n.is(":input"))u.addClass("parentForm"+t._getClassName(n.parents("form").attr("id")));u.addClass("formError");switch(i){case"pass":u.addClass("greenPopup");break;case"load":u.addClass("blackPopup");break;default:o.InvalidCount++}if(s)u.addClass("ajaxed");var a=e("<div>").addClass("formErrorContent").html(r).appendTo(u);if(o.showArrow){var f=e("<div>").addClass("formErrorArrow");switch(n.data("promptPosition")||o.promptPosition){case"bottomLeft":case"bottomRight":u.find(".formErrorContent").before(f);f.addClass("formErrorArrowBottom").html('<div class="line1"><!-- --></div><div class="line2"><!-- --></div><div class="line3"><!-- --></div><div class="line4"><!-- --></div><div class="line5"><!-- --></div><div class="line6"><!-- --></div><div class="line7"><!-- --></div><div class="line8"><!-- --></div><div class="line9"><!-- --></div><div class="line10"><!-- --></div>');break;case"topLeft":case"topRight":f.html('<div class="line10"><!-- --></div><div class="line9"><!-- --></div><div class="line8"><!-- --></div><div class="line7"><!-- --></div><div class="line6"><!-- --></div><div class="line5"><!-- --></div><div class="line4"><!-- --></div><div class="line3"><!-- --></div><div class="line2"><!-- --></div><div class="line1"><!-- --></div>');u.append(f);break}}if(o.isOverflown)n.before(u);else e("body").append(u);var l=t._calculatePosition(n,u,o);u.css({top:l.callerTopPosition,left:l.callerleftPosition,marginTop:l.marginTopSize,opacity:0}).data("callerField",n);return u.animate({opacity:.87})},_updatePrompt:function(e,n,r,i,s,o,u){if(n){if(typeof i!=="undefined"){if(i=="pass")n.addClass("greenPopup");else n.removeClass("greenPopup");if(i=="load")n.addClass("blackPopup");else n.removeClass("blackPopup")}if(s)n.addClass("ajaxed");else n.removeClass("ajaxed");n.find(".formErrorContent").html(r);var a=t._calculatePosition(e,n,o),f={top:a.callerTopPosition,left:a.callerleftPosition,marginTop:a.marginTopSize};if(u)n.css(f);else n.animate(f)}},_closePrompt:function(e){var n=t._getPrompt(e);if(n)n.fadeTo("fast",0,function(){n.remove()})},closePrompt:function(e){return t._closePrompt(e)},_getPrompt:function(n){var r=n.attr("id").replace(":","_")+"formError";var i=e("."+t._escapeExpression(r))[0];if(i)return e(i)},_escapeExpression:function(e){return e.replace(/([#;&,\.\+\*\~':"\!\^$\[\]\(\)=>\|])/g,"\\$1")},_calculatePosition:function(e,t,n){var r,i,s;var o=e.width();var u=t.height();var a=n.isOverflown;if(a){r=i=0;s=-u}else{var f=e.offset();r=f.top;i=f.left;s=0}switch(e.data("promptPosition")||n.promptPosition){default:case"topRight":if(a)i+=o-30;else{i+=o-30;r+=-u-2}break;case"topLeft":r+=-u-10;break;case"centerRight":i+=o+13;break;case"bottomLeft":r=r+e.height()+15;break;case"bottomRight":i+=o-30;r+=e.height()+5}return{callerTopPosition:r+"px",callerleftPosition:i+"px",marginTopSize:s+"px"}},_saveOptions:function(t,n){if(e.validationEngineLanguage)var r=e.validationEngineLanguage.allRules;else e.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page");e.validationEngine.defaults.allrules=r;var i=e.extend({},e.validationEngine.defaults,n);t.data("jqv",i);return i},_getClassName:function(e){return e.replace(":","_").replace(".","_")}};e.fn.validationEngine=function(n){var r=e(this);if(!r[0])return false;if(typeof n=="string"&&n.charAt(0)!="_"&&t[n]){if(n!="showPrompt"&&n!="hidePrompt"&&n!="hide"&&n!="hideAll")t.init.apply(r);return t[n].apply(r,Array.prototype.slice.call(arguments,1))}else if(typeof n=="object"||!n){t.init.apply(r,arguments);return t.attach.apply(r)}else{e.error("Method "+n+" does not exist in jQuery.validationEngine")}};e.validationEngine={defaults:{validationEventTrigger:"blur",scroll:true,focusFirstField:true,promptPosition:"topRight",bindMethod:"bind",inlineAjax:false,ajaxFormValidation:false,ajaxFormValidationURL:false,onAjaxFormComplete:e.noop,onBeforeAjaxFormValidation:e.noop,onValidationComplete:false,isOverflown:false,overflownDIV:"",binded:false,showArrow:true,isError:false,ajaxValidCache:{},autoPositionUpdate:false,InvalidFields:[],onSuccess:false,onFailure:false}}})(jQuery)